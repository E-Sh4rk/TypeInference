\documentclass[a4paper]{article}

\usepackage{setup}

\hypersetup{pdfstartview=XYZ}%         zoom par defaut

\setlength{\droptitle}{-5em}   % This is your set screw
\title{\vspace{1.5cm}Type inference - M2 Internship}
\author{Mickael LAURENT}
\date{\vspace{-5ex}}

\pagenumbering{gobble}

\theoremstyle{definition}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{definition}{Definition}
\newtheorem{property}{Property}
\newtheorem{corollary}{Corollary}

\begin{document}

  \maketitle

  We define $\tyof e \Gamma$ as follows:
  \begin{align*}
    \tyof e \Gamma = 
    \left\{\begin{array}{ll}
      \ts & \text{if } \Gamma \vdashA e:\ts \\
      \tsempty & \text{otherwise}
    \end{array}\right.
  \end{align*}

  \section{Definitions}

    \begin{definition}[Bottom environment]
      Let $\Gamma$ an environment.\\
      $\Gamma$ is bottom (noted $\Gamma = \bot$) iff $\exists e\in\dom\Gamma.\ \Gamma(e)\simeq\Empty$.
    \end{definition}

    \begin{definition}[(Pre)order on environments]
    Let $\Gamma$ and $\Gamma'$ two environments. We say that $\Gamma' \leqA \Gamma$ iff:
    \begin{align*}
        &\Gamma'=\bot \text{ or } (\Gamma\neq\bot \text{ and } \forall e \in \dom \Gamma.\ \tyof e \Gamma \leq \Gamma(e))
    \end{align*}
    \end{definition}

%    \begin{definition}[Plinth]
%      A plinth $S$ is a set of types such that:
%      \begin{itemize}
%        \item $S$ is finite.
%        \item $\Empty \in S$ and $S$ is stable by $\neg, \land, \vee$. 
%        \item If $\tau$ is a DNF of $t\in S$, let's introduce $A=\{t_a \alt \exists (P,N) \in \tau \text{ s.t. } t_a \in P \text{ or } t_a \in N \}$. Thus:
%        \begin{itemize}
%          \item For all $t_a \in A$, we have $t_a \in S$.
%          \item For all $t_1$, $t_2$ such that $\arrow {t_1} {t_2} \in A$ or $\pair {t_1} {t_2} \in A$,
%          we have $t_1 \in S$ and $t_2 \in S$.
%        \end{itemize}
%      \end{itemize}
%    \end{definition}
%
%    \begin{definition}[n-generated types]
%      A structure is a tree defined by the following grammar:
%      \[
%        \begin{array}{lrcl}
%        \textbf{Structure} & s & ::= & [] \alt \pair s s \alt \arrow s s \alt \neg s\\
%        \end{array}
%      \]
%      
%      A structure has depth $n$ if the associated tree has depth $n$, without counting the $\neg$ nodes and the leaves.
%
%      For a structure $s$ and a vector of types $\vec t$, we denote by $s[\vec t]$ the type obtained by replacing every
%      hole (=leaf) of $s$ by the associated type in $\vec t$ (the i-th hole of $s$ is replaced by the i-th component of $\vec t$).
%
%      A type $t$ is n-generated by a set of types $T$ if $t$ can be written
%      $t=\bigvee_{i\in I}\left(\bigwedge_{j\in J_i}t_j\right)$ with $I$ and all $J_i$ finites,
%      and such that all $t_j$ can be written $t_j = s[\vec t]$ with $s$ a structure of depth at most $n$
%      and $\vec t$ a vector of elements of $T$.
%    \end{definition}

  \section{Theorems}

  \begin{lemma}[Monotonicity and well-definedness of $\Refine {e,t} \Gamma$]
    \begin{align*}
      &\forall e,\Gamma,\Gamma'.\ \Gamma'\leqA\Gamma \Rightarrow \tyof e {\Gamma'} \leq \tyof e {\Gamma}\\
      &\forall e,t,\Gamma.\ \tyof e \Gamma \neq \tsempty \Rightarrow \Refine {e,t} \Gamma \text{ is well-defined}\\
      &\forall e,t,\Gamma,\Gamma'.\ \Gamma'\leqA\Gamma \text{ and } \tyof e \Gamma \neq \tsempty \Rightarrow \Refine {e,t} {\Gamma'} \leq \Refine {e,t} \Gamma\\
    \end{align*}
  \end{lemma}

%  Moreover, the greatest fixpoint $\fixpoint_\Gamma (\RefineStep {e,t})$ can be computed by iterating
%  the application of $\RefineStep {e,t}$ starting from $\gamma$, until a fixed point is reached.
%  The termination will be proved later.

%  \begin{lemma}
%    Every finite set of types is included in a plinth.
%  \end{lemma}
%  Proof: Alain Frisch thesis, theorem 3.8 (p64) [TODO: ref].
%
%  \begin{theorem}[$\texttt{Refine}$ computation]
%    The fixpoint $\fixpoint_\Gamma (\RefineStep {e,t})$ can be reached in a finite number of iterations.
%  \end{theorem}

  \begin{theorem}[Soundness of the algorithm]
    \begin{align*}
      &\forall \Gamma, e, t.\ t\in\tyof e \Gamma \Rightarrow \Gamma \vdash e:t\text{ is derivable}\\
      &\forall \Gamma, \Gamma', e, t.\ \Refine {e,t} \Gamma = \Gamma' \Rightarrow \Gamma \evdash e t \Gamma' \text{ is derivable}\\
      &\forall \Gamma, e, t, t', \varpi.\ \env {\Gamma,e,t} (\varpi) = t' \Rightarrow\ \pvdash \Gamma e t \varpi:t' \text{ is derivable}
    \end{align*}
  \end{theorem}

  \section{Proofs}

%  \subsection{$\texttt{Refine}$ computation}
%
%  Let $\Gamma$, $p$, $e$ and $t$.
%
%  Let's prove that we can reach $\Refine {e,t} \Gamma=\fixpoint_\Gamma (\RefineStep {e,t})$ by applying successively the function $\RefineStep {e,t}$ a finite number of times.
%
%  We will prove that, starting from $\Gamma$, successive applications of $\RefineStep {e,t}$ stay in a finite set of environments (modulo equivalence).
%  For now, let's suppose that $e$ does not contain any \texttt{if then else}. Let's note $\Gamma_i$ the environment after the i-th iteration.
%
%  For any path $\varpi$, we want to find an integer $n$ and a finite set of type $T$ such that $\Gamma_i(\occ e \varpi)$
%  is $n$-generated by $T$ for any $i$.
%
%  \newcommand{\depth}[0]{\mathcal{D}}
%  \newcommand{\pathdep}[2]{\texttt{path\_depth}_{#1}(#2)}
%  \newcommand{\depof}[2]{\texttt{depthof}_{#1}(#2)}
%  \newcommand{\rds}[1]{\texttt{RefineDepthStep}_{#1}}
%  \newcommand{\rd}[2]{\texttt{RefineDepth}_{#1}(#2)}
%
%  We call \textit{depth environment} a partial function from variables, constants and lambda abstractions
%  to (finite) integers. For each depth environment $\depth$ and expression $e$, we define $\depof \depth e$ by:
%  \[
%    \left\{
%      \begin{array}{lcl}
%        \depof{\depth}{c} & = & \depth(c) \\
%        \depof{\depth}{x} & = & \depth(x) \\
%        \depof{\depth}{\lambda^tx.e} & = & \depth(\lambda^tx.e) \\
%        \depof{\depth}{(e_1,e_2)} & = & \max {\{\depof{\depth}{e_1},\depof{\depth}{e_2}\}}+1 \\
%        \depof{\depth}{e_1 e_2} & = & \depof{\depth}{e_1}-1 \\
%        \depof{\depth}{\bpi_i e} & = & \depof{\depth}{e}-1
%      \end{array}  
%    \right.
%  \]
%
%  We also define the depth of a path $\varpi$ by:
%  \[
%    \left\{
%      \begin{array}{lcl}
%        \pathdep{\depth,e}{\epsilon} & = & \depof{\depth}{e}\\
%        \pathdep{\depth,e}{\varpi.0} & = & \max {\{\pathdep{\depth,e}{\varpi.1},\pathdep{\depth,e}{\varpi}\}}+1\\
%        \pathdep{\depth,e}{\varpi.1} & = & \depof{\depth}{\occ e {\varpi.0}}-1\\
%        \pathdep{\depth,e}{\varpi.l} & = & \pathdep{\depth,e}{\varpi}-1\\
%        \pathdep{\depth,e}{\varpi.r} & = & \pathdep{\depth,e}{\varpi}-1\\
%        \pathdep{\depth,e}{\varpi.f} & = & \pathdep{\depth,e}{\varpi}+1\\
%        \pathdep{\depth,e}{\varpi.s} & = & \pathdep{\depth,e}{\varpi}+1
%      \end{array}  
%    \right.
%  \]

%  \begin{align*}
%    &(\rds e (\depth))(e') = 
%      \left\{\begin{array}{ll}
%        \max \{\pathdep{\depth,e}{\varpi} \alt \varpi \text{ s.t. } \occ e \varpi \equiv e'\} & \text{if e' variable, constant or $\lambda$-abstraction and } \exists \varpi.\ \occ e \varpi \equiv e'\\
%        \text{undefined} & \text{otherwise}
%      \end{array}\right.\\&\\
%    &\rd e \depth=\textsf{lfp}_\depth (\rds e)
%  \end{align*}
%
%  Let $\depth_I$ be the depth environment that maps every occurence of variable, constant or $\lambda$-abstraction
%  in $e$ to $0$.
%
%  Let's show that $\depth = \rd e {\depth_I}$ is well-defined.
%  As $\rds e$ is monotonic (and even extensive), we just have to show that there exists a fixpoint $\depth_F$.

\end{document}